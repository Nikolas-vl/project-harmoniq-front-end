import{r as i,f as k,v as M,e as E,w as O,u as T,a as D,j as e,V as w}from"./index-DHh4YB8P.js";import{c as R,b as P,F as $,d as A,E as u,e as N}from"./index.esm-DNu_9HVH.js";import{c as G}from"./photo-JblrDacA.js";import{u as V,e as q}from"./editor-COLJmGco.js";import{e as I,a as C}from"./eye-crossed-Dmo-NlkL.js";import{u as z,a as H}from"./useLoader-CUwWdICU.js";const J="_form_1y856_3",K="_wrapper_1y856_12",Q="_closeBtn_1y856_15",X="_mainText_1y856_24",Y="_fileInputWrapper_1y856_29",Z="_preview_1y856_59",ee="_previewWrapper_1y856_66",se="_editIcon_1y856_73",ae="_error_1y856_84",re="_saveBtn_1y856_93",te="_labelChangeInfo_1y856_112",oe="_inputChangeInfo_1y856_119",ne="_inputWrapper_1y856_128",le="_seePass_1y856_135",s={form:J,wrapper:K,closeBtn:Q,mainText:X,fileInputWrapper:Y,preview:Z,previewWrapper:ee,editIcon:se,error:ae,saveBtn:re,labelChangeInfo:te,inputChangeInfo:oe,inputWrapper:ne,seePass:le},ie="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.25%201.25L8%208M8%208L1.25%2014.75M8%208L14.75%2014.75M8%208L14.75%201.25'%20stroke='%23070721'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ce=()=>{const[d,j]=i.useState(null),[c,o]=i.useState(!1),f=k();return z(c),{updateProfile:async(n,m)=>{o(!0);try{const t=await H(n,m);return j(t.data),f(M(t.user)),o(!1),t.data}catch(t){o(!1),console.error("Failed to update profile",t)}},isLoading:c,data:d}},pe=()=>{const d=E(),c=O().state?.isNew===!0,o=T(D),{updateProfile:f,loading:g}=ce(),{user:n}=V(o),[m,t]=i.useState(null),[h,y]=i.useState(null),[x,U]=i.useState(!1),[_,b]=i.useState(!1);i.useEffect(()=>{n?.avatarUrl&&t(n.avatarUrl)},[n]);const W=R({name:P().min(2,"At least 2 characters").max(32).trim(),oldPassword:P().min(6,"At least 6 characters"),newPassword:P().min(6,"At least 6 characters").when("oldPassword",{is:a=>a&&a.length>0,then:a=>a.required("New password required")})}),S=(a,l)=>{const r=a.target.files[0];if(r){if(r.size>2*1024*1024){l("image","The file is too large. Max 2MB.");return}if(!["image/jpeg","image/png"].includes(r.type)){l("image","Only JPG and PNG images allowed.");return}y(r),t(URL.createObjectURL(r)),l("image","")}},B=()=>{y(null),t(n?.avatarUrl||null),d(-1)};return e.jsx("div",{className:s.wrapper,children:e.jsx($,{enableReinitialize:!0,initialValues:{name:n?.name||"",oldPassword:"",newPassword:""},validationSchema:W,onSubmit:async(a,{setSubmitting:l})=>{const r=a.name.trim()!==n?.name,v=a.oldPassword.trim().length>0&&a.newPassword.trim().length>0,L=r||v||h;if(c&&!h){w.error("Please select a photo");return}if(!L){w.error("No changes made.");return}const p={};h&&(p.image=h),r&&(p.newName=a.name.trim()),v&&(p.oldPassword=a.oldPassword,p.newPassword=a.newPassword);try{await f(o,p),w.success("Profile updated"),d(`/authors/${o}`)}catch(F){w.error("Upload failed"),console.error(F)}finally{l(!1)}},children:({setFieldError:a,isSubmitting:l})=>e.jsxs(A,{className:s.form,children:[e.jsx("button",{type:"button",className:s.closeBtn,onClick:B,children:e.jsx("img",{src:ie,alt:"close",className:s.icon})}),e.jsx("h2",{className:s.mainText,children:c?"Upload your photo":"Update your profile"}),e.jsxs("label",{htmlFor:"photo",className:s.fileInputWrapper,children:[m?e.jsxs("div",{className:s.previewWrapper,children:[e.jsx("img",{src:m,alt:"Preview",className:s.preview}),o&&e.jsx("img",{src:q,alt:"Change photo",className:s.editIcon})]}):e.jsx("img",{src:G,alt:"camera",className:s.icon}),e.jsx("input",{id:"photo",name:"image",type:"file",accept:"image/*",onChange:r=>S(r,a),className:s.fileInput})]}),e.jsx(u,{name:"image",component:"div",className:s.error}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:s.labelChangeInfo,children:["New name:",e.jsx(N,{type:"text",name:"name",className:s.inputChangeInfo}),e.jsx(u,{name:"name",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["Old password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:x?"text":"password",name:"oldPassword",placeholder:"Enter old password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>U(r=>!r),className:s.seePass,children:e.jsx("img",{src:x?I:C,alt:x?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(u,{name:"oldPassword",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["New password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:_?"text":"password",name:"newPassword",placeholder:"Enter new password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>b(r=>!r),className:s.seePass,children:e.jsx("img",{src:_?I:C,alt:_?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(u,{name:"newPassword",component:"div",className:s.error})]})]}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:l||g,children:g?"Uploading...":"Save"})]})})})},de="_uploadPhotoWrapper_2t4vj_1",me={uploadPhotoWrapper:de},_e=()=>e.jsx("section",{className:`container ${me.uploadPhotoWrapper}`,children:e.jsx(pe,{})});export{_e as default};
