import{j as l,r as m,u as b,a as C,f as v,q as w,e as L,V as j}from"./index-DHh4YB8P.js";import{u as S,c as F,a as T,b as f}from"./index.esm-DNu_9HVH.js";import{c as N}from"./articlesApi-BVhVXxlf.js";const y="_form_1wv15_1",I="_titleLabel_1wv15_19",U="_fileLabel_1wv15_29",A="_textareaLabel_1wv15_38",R="_camera_1wv15_47",$="_fileInput_1wv15_66",E="_input_1wv15_69",O="_textarea_1wv15_38",q="_errored_1wv15_99",M="_error_1wv15_99",D="_button_1wv15_108",u={form:y,titleLabel:I,fileLabel:U,textareaLabel:A,camera:R,fileInput:$,input:E,textarea:O,errored:q,error:M,button:D},V=({error:e,onChange:t,photoUrl:n})=>{const a=i=>{const r=i.target.files[0];if(r){if(r.size>2097152){alert("The file is too large. Maximum 2MB.");return}t&&t(r)}};return l.jsxs("label",{className:u.fileLabel,htmlFor:"upload-photo",children:[l.jsx("img",{width:361,height:233,id:"photo-preview",src:n,alt:"Click to upload",className:`${u.camera} ${e?u.errored:""}`}),l.jsx("input",{name:"image",type:"file",id:"upload-photo",accept:"image/*",className:u.fileInput,onChange:a}),l.jsx("span",{className:u.error,children:e||" "})]})},k=({touched:e,error:t,value:n,onChange:a})=>{const i=m.useRef(null);return m.useEffect(()=>{const r=i.current;if(!r)return;const c=r.clientHeight,o=()=>{r.style.height="auto";const h=Math.max(r.scrollHeight,c);r.style.height=`${h}px`};return r.addEventListener("input",o),()=>{r.removeEventListener("input",o)}},[]),l.jsxs("label",{className:u.textareaLabel,children:[l.jsx("textarea",{name:"text",ref:i,id:"article-text",placeholder:"Enter a text",className:`${u.textarea} ${e&&t?u.errored:""}`,value:n,onChange:r=>a(r.target.value),style:{resize:"none",overflow:"hidden"}}),l.jsx("span",{className:u.error,children:e&&t?t:" "})]})},B=({touched:e,error:t,value:n,onChange:a})=>{const i=m.useRef(null),r=()=>{const o=i.current;requestAnimationFrame(()=>{o.selectionStart=o.selectionEnd=o.value.length,o.scrollLeft=o.scrollWidth})},c=()=>{const o=i.current;o.scrollLeft=0};return l.jsxs("label",{className:u.titleLabel,htmlFor:"titleInput",children:["Article Title",l.jsx("input",{name:"title",ref:i,type:"text",id:"titleInput",className:`${u.input} ${e&&t?u.errored:""}`,placeholder:"Enter the title",onFocus:r,onBlur:c,value:n,onChange:o=>a(o.target.value)}),l.jsx("span",{className:u.error,children:e&&t?t:" "})]})},z=e=>{const t=e.match(/[^.!?]+[.!?]/);if(t){const n=t[0].trim();if(n.length>=10)return n}return e.length>50?e.slice(0,50).trim()+"...":e.trim()},H=(e,t)=>{const n=m.useRef(null);m.useEffect(()=>(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e()},t),()=>clearTimeout(n.current)),[e,t])};function P(e,t,n=1500){const[a,i]=m.useState(()=>{try{const c=localStorage.getItem(e);return c!==null?JSON.parse(c):t}catch{return t}}),r=m.useCallback(()=>{try{localStorage.setItem(e,JSON.stringify(a))}catch(c){console.log(c)}},[e,a]);return H(r,n),[a,i]}const p="data:image/svg+xml,%3csvg%20width='391'%20height='280'%20viewBox='0%200%20391%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='391'%20height='280'%20fill='%239F9F9F'/%3e%3cpath%20d='M214.371%20146.212C214.371%20154.788%20206.099%20161.74%20195.897%20161.74C185.694%20161.74%20177.423%20154.788%20177.423%20146.212C177.423%20137.635%20185.694%20130.683%20195.897%20130.683C206.099%20130.683%20214.371%20137.635%20214.371%20146.212Z'%20stroke='%23070707'/%3e%3cpath%20d='M147.864%20167.625L147.864%20129.776C147.864%20123.416%20153.998%20118.26%20161.565%20118.26C166.755%20118.26%20171.499%20115.795%20173.82%20111.893L176.925%20106.673C179.494%20102.354%20184.747%2099.625%20190.492%2099.625L201.301%2099.625C207.047%2099.6251%20212.299%20102.354%20214.868%20106.673L217.973%20111.893C220.294%20115.795%20225.038%20118.26%20230.228%20118.26C237.795%20118.26%20243.929%20123.416%20243.929%20129.776V167.625C243.929%20174.667%20237.138%20180.375%20228.761%20180.375H163.032C154.655%20180.375%20147.864%20174.667%20147.864%20167.625Z'%20stroke='%23070707'/%3e%3c/svg%3e",J=e=>{const t=b(C),[n,a]=P("articleDraft",{title:"",text:"",image:null}),[i,r]=m.useState(p);m.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const c=S({initialValues:n,validationSchema:F({title:f().required("Title is required").min(5,"Title must be at least 5 characters").max(100,"Title must be at most 100 characters"),text:f().required("Text is required").min(100,"Text must be at least 100 characters"),image:T().required("Image is required").test("fileSize","Maximum file size is 2MB",s=>!s||s&&s.size<=2*1024*1024).test("fileType","Only jpg and png images are allowed",s=>!s||s&&["image/jpeg","image/png"].includes(s.type))}),validateOnBlur:!1,validateOnChange:!1,onSubmit:async(s,{setSubmitting:d,setErrors:x})=>{try{const _={image:s.image,title:s.title,desc:z(s.text),article:s.text,rate:0,ownerId:t,date:new Date().toISOString()};await e(_),a({title:"",text:"",image:null}),r(p)}catch{x({submit:"Помилка при створенні статті. Спробуйте пізніше."})}finally{d(!1)}}});return{formik:c,previewUrl:i,handleFileChange:s=>{if(!s){r(p),c.setFieldValue("image",null);return}i&&URL.revokeObjectURL(i);const d=URL.createObjectURL(s);r(d),c.setFieldValue("image",s)},handleTitleChange:s=>{a(d=>({...d,title:s}))},handleTextChange:s=>{a(d=>({...d,text:s}))}}},W=()=>{const[e,t]=m.useState(!1),n=v();return{create:async i=>{t(!0);try{const c=(await N(i)).data.data;return n(w(c)),c}catch(r){console.error("Failed to create article:",r)}finally{t(!1)}},isLoading:e}},Z=()=>{const{create:e,isLoading:t}=W(),n=L(),{formik:a,previewUrl:i,handleFileChange:r,handleTitleChange:c,handleTextChange:o}=J(async h=>{try{const s=(await e(h))._id;n(`/articles/${s}`)}catch(g){j.error("An error occurred when creating an article!"),console.error(g)}});return l.jsxs("form",{className:u.form,onSubmit:a.handleSubmit,children:[l.jsx(V,{onChange:r,photoUrl:i,error:a.errors.image}),l.jsx(B,{value:a.values.title,onChange:h=>{a.setFieldValue("title",h),c(h)},error:a.errors.title,touched:a.touched.title}),l.jsx(k,{value:a.values.text,onChange:h=>{a.setFieldValue("text",h),o(h)},error:a.errors.text,touched:a.touched.text}),l.jsx("button",{disabled:a.isSubmitting||t,type:"submit",className:u.button,children:a.isSubmitting||t?l.jsx("span",{className:"loading"}):"Publish Article"})]})},G="_title_10ppv_1",K="_section_10ppv_6",ee=()=>l.jsxs("section",{className:`container ${K}`,children:[l.jsx("h1",{className:G,children:"Create an article"}),l.jsx(Z,{})]});export{ee as default};
