import{r as l,c as M,f as E,n as O,u as T,s as $,j as e,V as h,e as R}from"./index-Bom5OTRP.js";import{c as q,b as N,F as A,d as D,E as w,e as j}from"./index.esm-D83MXirt.js";import{c as G}from"./photo-JblrDacA.js";import{u as V,e as z}from"./editor-D8atHohJ.js";import{e as U,a as b}from"./eye-crossed-Dmo-NlkL.js";import{u as H,a as J}from"./useLoader-DggHw84-.js";const K="_form_17p81_3",Q="_closeBtn_17p81_13",X="_mainText_17p81_23",Y="_fileInputWrapper_17p81_28",Z="_preview_17p81_59",ee="_previewWrapper_17p81_66",se="_editIcon_17p81_75",ae="_error_17p81_86",re="_saveBtn_17p81_95",te="_labelChangeInfo_17p81_114",oe="_inputChangeInfo_17p81_121",ne="_inputWrapper_17p81_130",le="_seePass_17p81_137",s={form:K,closeBtn:Q,mainText:X,fileInputWrapper:Y,preview:Z,previewWrapper:ee,editIcon:se,error:ae,saveBtn:re,labelChangeInfo:te,inputChangeInfo:oe,inputWrapper:ne,seePass:le},ie="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.25%201.25L8%208M8%208L1.25%2014.75M8%208L14.75%2014.75M8%208L14.75%201.25'%20stroke='%23070721'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ce=()=>{const[u,p]=l.useState(null),[f,o]=l.useState(!1);return H(f),{updateProfile:async(g,d)=>{o(!0);try{const t=await J(g,d);return p(t.data),o(!1),t.data}catch(t){o(!1),console.error("Failed to update profile",t)}},isLoading:f,data:u}},pe=()=>{const u=M(),p=E(),o=O().state?.isNew===!0,i=T($),{updateProfile:g,loading:d}=ce(),{user:t}=V(i),[v,x]=l.useState(null),[m,I]=l.useState(null),[_,y]=l.useState(!1),[P,W]=l.useState(!1);l.useEffect(()=>{t?.avatarUrl&&x(t.avatarUrl)},[t]);const S=q({name:N().min(2,"At least 2 characters").max(32).trim(),oldPassword:N().min(6,"At least 6 characters"),newPassword:N().min(6,"At least 6 characters").when("oldPassword",{is:a=>a&&a.length>0,then:a=>a.required("New password required")})}),B=(a,n)=>{const r=a.target.files[0];if(r){if(r.size>2*1024*1024){n("image","The file is too large. Max 2MB.");return}if(!["image/jpeg","image/png"].includes(r.type)){n("image","Only JPG and PNG images allowed.");return}I(r),x(URL.createObjectURL(r)),n("image","")}},L=()=>{I(null),x(t?.avatarUrl||null),p(-1)};return e.jsx("div",{className:`container ${s.wrapper}`,children:e.jsx(A,{enableReinitialize:!0,initialValues:{name:t?.name||"",oldPassword:"",newPassword:""},validationSchema:S,onSubmit:async(a,{setSubmitting:n})=>{const r=a.name.trim()!==t?.name,C=a.oldPassword.trim().length>0&&a.newPassword.trim().length>0,F=r||C||m;if(o&&!m){h.error("Please select a photo");return}if(!F){h.error("No changes made.");return}const c={};m&&(c.image=m),r&&(c.newName=a.name.trim()),C&&(c.oldPassword=a.oldPassword,c.newPassword=a.newPassword);try{await g(i,c),u(R()),h.success("Profile updated"),p(`/authors/${i}`)}catch(k){h.error("Upload failed"),console.error(k)}finally{n(!1)}},children:({setFieldError:a,isSubmitting:n})=>e.jsxs(D,{className:s.form,children:[e.jsx("button",{type:"button",className:s.closeBtn,onClick:L,children:e.jsx("img",{src:ie,alt:"close",className:s.icon})}),e.jsx("h2",{className:s.mainText,children:o?"Upload your photo":"Update your profile"}),e.jsxs("label",{htmlFor:"photo",className:s.fileInputWrapper,children:[v?e.jsxs("div",{className:s.previewWrapper,children:[e.jsx("img",{src:v,alt:"Preview",className:s.preview}),i&&e.jsx("img",{src:z,alt:"Change photo",className:s.editIcon})]}):e.jsx("img",{src:G,alt:"camera",className:s.icon}),e.jsx("input",{id:"photo",name:"image",type:"file",accept:"image/*",onChange:r=>B(r,a),className:s.fileInput})]}),e.jsx(w,{name:"image",component:"div",className:s.error}),!o&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:s.labelChangeInfo,children:["New name:",e.jsx(j,{type:"text",name:"name",className:s.inputChangeInfo}),e.jsx(w,{name:"name",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["Old password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(j,{type:_?"text":"password",name:"oldPassword",placeholder:"Enter old password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>y(r=>!r),className:s.seePass,children:e.jsx("img",{src:_?U:b,alt:_?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"oldPassword",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["New password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(j,{type:P?"text":"password",name:"newPassword",placeholder:"Enter new password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>W(r=>!r),className:s.seePass,children:e.jsx("img",{src:P?U:b,alt:P?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"newPassword",component:"div",className:s.error})]})]}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:n||d,children:d?"Uploading...":"Save"})]})})})},de="_uploadPhotoWrapper_7eqca_1",me={uploadPhotoWrapper:de},_e=()=>e.jsx("section",{className:`container ${me.uploadPhotoWrapper}`,children:e.jsx(pe,{})});export{_e as default};
