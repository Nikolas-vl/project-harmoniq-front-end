import{r as n,u as M,f as E,e as O,a as T,d as $,j as e,V as h,m as R}from"./index-xz-e4_RC.js";import{c as V,b as P,F as q,d as A,E as w,e as N}from"./index.esm-B6uZb7PO.js";import{e as D}from"./editor-BVF5sQ-p.js";import{e as U,a as b}from"./eye-crossed-Dmo-NlkL.js";import{u as G}from"./usersApi-D4LaL_vX.js";import{u as H}from"./useGetUserInfo-DE8eMw6h.js";const z="_form_17p81_3",Z="_closeBtn_17p81_13",J="_mainText_17p81_23",K="_fileInputWrapper_17p81_28",Q="_preview_17p81_59",X="_previewWrapper_17p81_66",Y="_editIcon_17p81_75",ee="_error_17p81_86",se="_saveBtn_17p81_95",ae="_labelChangeInfo_17p81_114",te="_inputChangeInfo_17p81_121",re="_inputWrapper_17p81_130",oe="_seePass_17p81_137",s={form:z,closeBtn:Z,mainText:J,fileInputWrapper:K,preview:Q,previewWrapper:X,editIcon:Y,error:ee,saveBtn:se,labelChangeInfo:ae,inputChangeInfo:te,inputWrapper:re,seePass:oe},ne="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.25%201.25L8%208M8%208L1.25%2014.75M8%208L14.75%2014.75M8%208L14.75%201.25'%20stroke='%23070721'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",le="data:image/svg+xml,%3csvg%20width='72'%20height='61'%20viewBox='0%200%2072%2061'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M49.2452%2034.9303C49.2452%2041.0472%2043.3151%2046.006%2036%2046.006C28.6849%2046.006%2022.7548%2041.0472%2022.7548%2034.9303C22.7548%2028.8133%2028.6849%2023.8545%2036%2023.8545C43.3151%2023.8545%2049.2452%2028.8133%2049.2452%2034.9303Z'%20stroke='%23070707'%20stroke-width='2'/%3e%3cpath%20d='M1.5625%2050.2031L1.5625%2023.2082C1.5625%2018.6716%205.96049%2014.994%2011.3857%2014.994C15.1064%2014.994%2018.5078%2013.2361%2020.1718%2010.4533L22.3981%206.73002C24.2402%203.6492%2028.0058%201.70311%2032.125%201.70313L39.8751%201.70315C43.9942%201.70316%2047.7598%203.64925%2049.6019%206.73006L51.8282%2010.4533C53.4922%2013.2362%2056.8936%2014.994%2060.6143%2014.994C66.0395%2014.994%2070.4375%2018.6717%2070.4375%2023.2082V50.2031C70.4375%2055.2254%2065.5686%2059.2968%2059.5625%2059.2968H12.4375C6.4314%2059.2968%201.5625%2055.2254%201.5625%2050.2031Z'%20stroke='%23070707'%20stroke-width='2'/%3e%3c/svg%3e",ie=()=>{const[u,l]=n.useState(!1),[j,i]=n.useState(null);return{updateProfile:async(g,d)=>{l(!0);try{const r=await G(g,d);return i(r.data),l(!1),r.data}catch(r){l(!1),console.error("Failed to update profile",r)}},loading:u,data:j}},ce=()=>{const u=M(),l=E(),i=O().state?.isNew===!0,c=T($),{updateProfile:g,loading:d}=ie(),{user:r}=H(c),[v,f]=n.useState(null),[m,C]=n.useState(null),[x,y]=n.useState(!1),[_,W]=n.useState(!1);n.useEffect(()=>{r?.avatarUrl&&f(r.avatarUrl)},[r]);const S=V({name:P().min(2,"At least 2 characters").max(32).trim(),oldPassword:P().min(6,"At least 6 characters"),newPassword:P().min(6,"At least 6 characters").when("oldPassword",{is:a=>a&&a.length>0,then:a=>a.required("New password required")})}),L=(a,o)=>{const t=a.target.files[0];if(t){if(t.size>2*1024*1024){o("image","The file is too large. Max 2MB.");return}if(!["image/jpeg","image/png"].includes(t.type)){o("image","Only JPG and PNG images allowed.");return}C(t),f(URL.createObjectURL(t)),o("image","")}},k=()=>{C(null),f(r?.avatarUrl||null),l(-1)};return e.jsx("div",{className:`container ${s.wrapper}`,children:e.jsx(q,{enableReinitialize:!0,initialValues:{name:r?.name||"",oldPassword:"",newPassword:""},validationSchema:S,onSubmit:async(a,{setSubmitting:o})=>{const t=a.name.trim()!==r?.name,I=a.oldPassword.trim().length>0&&a.newPassword.trim().length>0,B=t||I||m;if(i&&!m){h.error("Please select a photo");return}if(!B){h.error("No changes made.");return}const p={};m&&(p.image=m),t&&(p.newName=a.name.trim()),I&&(p.oldPassword=a.oldPassword,p.newPassword=a.newPassword);try{await g(c,p),u(R()),h.success("Profile updated"),l(`/authors/${c}`)}catch(F){h.error("Upload failed"),console.error(F)}finally{o(!1)}},children:({setFieldError:a,isSubmitting:o})=>e.jsxs(A,{className:s.form,children:[e.jsx("button",{type:"button",className:s.closeBtn,onClick:k,children:e.jsx("img",{src:ne,alt:"close",className:s.icon})}),e.jsx("h2",{className:s.mainText,children:i?"Upload your photo":"Update your profile"}),e.jsxs("label",{htmlFor:"photo",className:s.fileInputWrapper,children:[v?e.jsxs("div",{className:s.previewWrapper,children:[e.jsx("img",{src:v,alt:"Preview",className:s.preview}),c&&e.jsx("img",{src:D,alt:"Change photo",className:s.editIcon})]}):e.jsx("img",{src:le,alt:"camera",className:s.icon}),e.jsx("input",{id:"photo",name:"image",type:"file",accept:"image/*",onChange:t=>L(t,a),className:s.fileInput})]}),e.jsx(w,{name:"image",component:"div",className:s.error}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:s.labelChangeInfo,children:["New name:",e.jsx(N,{type:"text",name:"name",className:s.inputChangeInfo}),e.jsx(w,{name:"name",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["Old password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:x?"text":"password",name:"oldPassword",placeholder:"Enter old password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>y(t=>!t),className:s.seePass,children:e.jsx("img",{src:x?U:b,alt:x?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"oldPassword",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["New password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:_?"text":"password",name:"newPassword",placeholder:"Enter new password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>W(t=>!t),className:s.seePass,children:e.jsx("img",{src:_?U:b,alt:_?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"newPassword",component:"div",className:s.error})]})]}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:o||d,children:d?"Uploading...":"Save"})]})})})},pe="_uploadPhotoWrapper_7eqca_1",de={uploadPhotoWrapper:pe},xe=()=>e.jsx("div",{className:`container ${de.uploadPhotoWrapper}`,children:e.jsx(ce,{})});export{xe as default};
