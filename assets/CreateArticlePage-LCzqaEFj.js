import{j as i,r as h,u as b,s as C,f as w,V as v}from"./index-Dzpd6dls.js";import{u as L,c as j,a as S,b as x}from"./index.esm-D8QwnOcW.js";import{c as F}from"./articlesApi-awO-Mnn3.js";const T="_form_1wv15_1",N="_titleLabel_1wv15_19",y="_fileLabel_1wv15_29",I="_textareaLabel_1wv15_38",U="_camera_1wv15_47",R="_fileInput_1wv15_66",$="_input_1wv15_69",A="_textarea_1wv15_38",E="_errored_1wv15_99",M="_error_1wv15_99",q="_button_1wv15_108",o={form:T,titleLabel:N,fileLabel:y,textareaLabel:I,camera:U,fileInput:R,input:$,textarea:A,errored:E,error:M,button:q},O=({error:t,onChange:r,photoUrl:l})=>{const e=s=>{const a=s.target.files[0];if(a){if(a.size>2097152){alert("The file is too large. Maximum 2MB.");return}r&&r(a)}};return i.jsxs("label",{className:o.fileLabel,htmlFor:"upload-photo",children:[i.jsx("img",{width:361,height:233,id:"photo-preview",src:l,alt:"Click to upload",className:`${o.camera} ${t?o.errored:""}`}),i.jsx("input",{name:"image",type:"file",id:"upload-photo",accept:"image/*",className:o.fileInput,onChange:e}),i.jsx("span",{className:o.error,children:t||" "})]})},V=({touched:t,error:r,value:l,onChange:e})=>{const s=h.useRef(null);return h.useEffect(()=>{const a=s.current;if(!a)return;const u=a.clientHeight,c=()=>{a.style.height="auto";const m=Math.max(a.scrollHeight,u);a.style.height=`${m}px`};return a.addEventListener("input",c),()=>{a.removeEventListener("input",c)}},[]),i.jsxs("label",{className:o.textareaLabel,children:[i.jsx("textarea",{name:"text",ref:s,id:"article-text",placeholder:"Enter a text",className:`${o.textarea} ${t&&r?o.errored:""}`,value:l,onChange:a=>e(a.target.value),style:{resize:"none",overflow:"hidden"}}),i.jsx("span",{className:o.error,children:t&&r?r:" "})]})},k=({touched:t,error:r,value:l,onChange:e})=>{const s=h.useRef(null),a=()=>{const c=s.current;requestAnimationFrame(()=>{c.selectionStart=c.selectionEnd=c.value.length,c.scrollLeft=c.scrollWidth})},u=()=>{const c=s.current;c.scrollLeft=0};return i.jsxs("label",{className:o.titleLabel,htmlFor:"titleInput",children:["Article Title",i.jsx("input",{name:"title",ref:s,type:"text",id:"titleInput",className:`${o.input} ${t&&r?o.errored:""}`,placeholder:"Enter the title",onFocus:a,onBlur:u,value:l,onChange:c=>e(c.target.value)}),i.jsx("span",{className:o.error,children:t&&r?r:" "})]})},D=t=>{const r=t.match(/[^.!?]+[.!?]/);if(r){const l=r[0].trim();if(l.length>=10)return l}return t.length>50?t.slice(0,50).trim()+"...":t.trim()},z=(t,r)=>{const l=h.useRef(null);h.useEffect(()=>(l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t()},r),()=>clearTimeout(l.current)),[t,r])};function B(t,r,l=1500){const[e,s]=h.useState(()=>{try{const u=localStorage.getItem(t);return u!==null?JSON.parse(u):r}catch{return r}}),a=h.useCallback(()=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(u){console.log(u)}},[t,e]);return z(a,l),[e,s]}const f="data:image/svg+xml,%3csvg%20width='391'%20height='280'%20viewBox='0%200%20391%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='391'%20height='280'%20fill='%239F9F9F'/%3e%3cpath%20d='M214.371%20146.212C214.371%20154.788%20206.099%20161.74%20195.897%20161.74C185.694%20161.74%20177.423%20154.788%20177.423%20146.212C177.423%20137.635%20185.694%20130.683%20195.897%20130.683C206.099%20130.683%20214.371%20137.635%20214.371%20146.212Z'%20stroke='%23070707'/%3e%3cpath%20d='M147.864%20167.625L147.864%20129.776C147.864%20123.416%20153.998%20118.26%20161.565%20118.26C166.755%20118.26%20171.499%20115.795%20173.82%20111.893L176.925%20106.673C179.494%20102.354%20184.747%2099.625%20190.492%2099.625L201.301%2099.625C207.047%2099.6251%20212.299%20102.354%20214.868%20106.673L217.973%20111.893C220.294%20115.795%20225.038%20118.26%20230.228%20118.26C237.795%20118.26%20243.929%20123.416%20243.929%20129.776V167.625C243.929%20174.667%20237.138%20180.375%20228.761%20180.375H163.032C154.655%20180.375%20147.864%20174.667%20147.864%20167.625Z'%20stroke='%23070707'/%3e%3c/svg%3e",H=t=>{const r=b(C),[l,e]=B("articleDraft",{title:"",text:"",image:null}),[s,a]=h.useState(f);h.useEffect(()=>()=>{s&&URL.revokeObjectURL(s)},[s]);const u=L({initialValues:l,validationSchema:j({title:x().required("Title is required").min(5,"Title must be at least 5 characters").max(100,"Title must be at most 100 characters"),text:x().required("Text is required").min(100,"Text must be at least 100 characters"),image:S().required("Image is required").test("fileSize","Maximum file size is 2MB",n=>!n||n&&n.size<=2*1024*1024).test("fileType","Only jpg and png images are allowed",n=>!n||n&&["image/jpeg","image/png"].includes(n.type))}),onSubmit:async(n,{setSubmitting:d,setErrors:_})=>{try{const p={image:n.image,title:n.title,desc:D(n.text),article:n.text,rate:0,ownerId:r,date:new Date().toISOString()};await t(p),e({title:"",text:"",image:null}),a(f)}catch(p){_({submit:"Помилка при створенні статті. Спробуйте пізніше."}),console.log(p)}finally{d(!1)}}});return{formik:u,previewUrl:s,handleFileChange:n=>{if(!n){a(f),u.setFieldValue("image",null);return}s&&URL.revokeObjectURL(s);const d=URL.createObjectURL(n);a(d),u.setFieldValue("image",n)},handleTitleChange:n=>{e(d=>({...d,title:n}))},handleTextChange:n=>{e(d=>({...d,text:n}))}}},P=()=>{const[t,r]=h.useState(!1);return{create:async e=>{r(!0);try{return(await F(e)).data.data}catch(s){console.error("Failed to create article:",s)}finally{r(!1)}},isLoading:t}},J=()=>{const{create:t,isLoading:r}=P(),l=w(),{formik:e,previewUrl:s,handleFileChange:a,handleTitleChange:u,handleTextChange:c}=H(async m=>{try{const n=(await t(m))._id;l(`/articles/${n}`)}catch(g){v.error("An error occurred when creating an article!"),console.error(g)}});return i.jsxs("form",{className:o.form,onSubmit:e.handleSubmit,children:[i.jsx(O,{onChange:a,photoUrl:s,error:e.errors.image}),i.jsx(k,{value:e.values.title,onChange:m=>{e.setFieldValue("title",m),u(m)},error:e.errors.title,touched:e.touched.title}),i.jsx(V,{value:e.values.text,onChange:m=>{e.setFieldValue("text",m),c(m)},error:e.errors.text,touched:e.touched.text}),i.jsx("button",{disabled:e.isSubmitting||r,type:"submit",className:o.button,children:e.isSubmitting||r?i.jsx("span",{className:"loading"}):"Publish Article"})]})},W="_title_10ppv_1",Z="_section_10ppv_6",X=()=>i.jsxs("section",{className:`container ${Z}`,children:[i.jsx("h1",{className:W,children:"Create an article"}),i.jsx(J,{})]});export{X as default};
