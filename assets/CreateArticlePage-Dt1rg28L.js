import{j as l,r as m,u as F,a as L,f as T,q as j,e as v,V as S}from"./index-C_-wtOrh.js";import{u as w,c as q,a as I,b}from"./index.esm-Bf32WNeV.js";import{c as N}from"./articlesApi-kQyM2v8i.js";const y="_form_iqafx_1",U="_titleLabel_iqafx_19",A="_fileLabel_iqafx_29",R="_textareaLabel_iqafx_38",$="_camera_iqafx_47",E="_fileInput_iqafx_66",O="_input_iqafx_69",V="_textarea_iqafx_38",D="_errored_iqafx_99",M="_error_iqafx_99",k="_button_iqafx_108",B="_success_iqafx_139",o={form:y,titleLabel:U,fileLabel:A,textareaLabel:R,camera:$,fileInput:E,input:O,textarea:V,errored:D,error:M,button:k,success:B},z=({error:e,onChange:t,photoUrl:n,touched:a})=>{const u=s=>{const r=s.target.files[0];if(r){if(r.size>2097152){alert("The file is too large. Maximum 2MB.");return}t&&t(r)}};return l.jsxs("label",{className:o.fileLabel,htmlFor:"upload-photo",children:[l.jsx("img",{width:361,height:233,id:"photo-preview",src:n,alt:"Click to upload",className:`${o.camera} ${e?o.errored:""}`}),l.jsx("input",{name:"image",type:"file",id:"upload-photo",accept:"image/*",className:o.fileInput,onChange:u}),l.jsx("span",{className:a?e?o.error:o.success:"",children:a?e||"Image is valid":" "})]})},H=({touched:e,error:t,value:n,onChange:a})=>{const u=m.useRef(null);return m.useEffect(()=>{const s=u.current;if(!s)return;const r=s.clientHeight,c=()=>{s.style.height="auto";const d=Math.max(s.scrollHeight,r);s.style.height=`${d}px`};return s.addEventListener("input",c),()=>{s.removeEventListener("input",c)}},[]),l.jsxs("label",{className:o.textareaLabel,children:[l.jsx("textarea",{name:"text",ref:u,id:"article-text",placeholder:"Enter a text",className:`${o.textarea} ${e&&t?o.errored:""}`,value:n,onChange:s=>a(s.target.value),style:{resize:"none",overflow:"hidden"}}),l.jsx("span",{className:e?t?o.error:o.success:"",children:e?t||"Text is valid":" "})]})},P=({touched:e,error:t,value:n,onChange:a})=>{const u=m.useRef(null),s=()=>{const c=u.current;requestAnimationFrame(()=>{c.selectionStart=c.selectionEnd=c.value.length,c.scrollLeft=c.scrollWidth})},r=()=>{const c=u.current;c.scrollLeft=0};return l.jsxs("label",{className:o.titleLabel,htmlFor:"titleInput",children:["Article Title",l.jsx("input",{name:"title",ref:u,type:"text",id:"titleInput",className:`${o.input} ${e&&t?o.errored:""}`,placeholder:"Enter the title",onFocus:s,onBlur:r,value:n,onChange:c=>a(c.target.value)}),l.jsx("span",{className:e?t?o.error:o.success:"",children:e?t||"Title is valid":" "})]})},J=e=>{const t=e.match(/[^.!?]+[.!?]/);if(t){const n=t[0].trim();if(n.length>=10)return n}return e.length>50?e.slice(0,50).trim()+"...":e.trim()},W=(e,t)=>{const n=m.useRef(null);m.useEffect(()=>(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e()},t),()=>clearTimeout(n.current)),[e,t])};function Z(e,t,n=1500){const[a,u]=m.useState(()=>{try{const r=localStorage.getItem(e);return r!==null?JSON.parse(r):t}catch{return t}}),s=m.useCallback(()=>{try{localStorage.setItem(e,JSON.stringify(a))}catch(r){console.log(r)}},[e,a]);return W(s,n),[a,u]}const p="data:image/svg+xml,%3csvg%20width='391'%20height='280'%20viewBox='0%200%20391%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='391'%20height='280'%20fill='%239F9F9F'/%3e%3cpath%20d='M214.371%20146.212C214.371%20154.788%20206.099%20161.74%20195.897%20161.74C185.694%20161.74%20177.423%20154.788%20177.423%20146.212C177.423%20137.635%20185.694%20130.683%20195.897%20130.683C206.099%20130.683%20214.371%20137.635%20214.371%20146.212Z'%20stroke='%23070707'/%3e%3cpath%20d='M147.864%20167.625L147.864%20129.776C147.864%20123.416%20153.998%20118.26%20161.565%20118.26C166.755%20118.26%20171.499%20115.795%20173.82%20111.893L176.925%20106.673C179.494%20102.354%20184.747%2099.625%20190.492%2099.625L201.301%2099.625C207.047%2099.6251%20212.299%20102.354%20214.868%20106.673L217.973%20111.893C220.294%20115.795%20225.038%20118.26%20230.228%20118.26C237.795%20118.26%20243.929%20123.416%20243.929%20129.776V167.625C243.929%20174.667%20237.138%20180.375%20228.761%20180.375H163.032C154.655%20180.375%20147.864%20174.667%20147.864%20167.625Z'%20stroke='%23070707'/%3e%3c/svg%3e",G=e=>{const t=F(L),[n,a]=m.useState({image:!1}),[u,s]=Z("articleDraft",{title:"",text:"",image:null}),[r,c]=m.useState(p);m.useEffect(()=>()=>{r&&URL.revokeObjectURL(r)},[r]);const d=w({initialValues:u,validationSchema:q({title:b().required("Title is required").min(5,"Title must be at least 5 characters").max(100,"Title must be at most 100 characters"),text:b().required("Text is required").min(2e3,"Text must be at least 2000 characters").max(1e4,"Text must be at most 10000 characters"),image:I().required("Image is required").test("fileSize","Maximum file size is 2MB",i=>!i||i&&i.size<=2*1024*1024).test("fileType","Only jpg and png images are allowed",i=>!i||i&&["image/jpeg","image/png"].includes(i.type))}),validateOnBlur:!1,validateOnChange:!0,onSubmit:async(i,{setSubmitting:g,setErrors:x})=>{try{const C={image:i.image,title:i.title,desc:J(i.text),article:i.text,rate:0,ownerId:t,date:new Date().toISOString()};await e(C),s({title:"",text:"",image:null}),c(p)}catch{x({submit:"Помилка при створенні статті. Спробуйте пізніше."})}finally{g(!1)}}});return{formik:d,previewUrl:r,handleFileChange:i=>{if(a(x=>({...x,image:!0})),d.setFieldTouched("image",!0,!1),!i){c(p),d.setFieldValue("image",null),d.validateField("image");return}r&&URL.revokeObjectURL(r);const g=URL.createObjectURL(i);c(g),d.setFieldValue("image",i),d.validateField("image")},handleTitleChange:i=>{d.setFieldTouched("title",!0,!1),d.setFieldValue("title",i),s(g=>({...g,title:i}))},handleTextChange:i=>{d.setFieldTouched("text",!0,!1),d.setFieldValue("text",i),s(g=>({...g,text:i}))},touchedFields:n}},K=()=>{const[e,t]=m.useState(!1),n=T();return{create:async u=>{t(!0);try{const r=(await N(u)).data.data;return n(j(r)),r}catch(s){console.error("Failed to create article:",s)}finally{t(!1)}},isLoading:e}},Q=()=>{const{create:e,isLoading:t}=K(),n=v(),{formik:a,previewUrl:u,handleFileChange:s,handleTitleChange:r,handleTextChange:c}=G(async h=>{try{const _=(await e(h))._id;n(`/articles/${_}`)}catch(f){S.error("An error occurred when creating an article!"),console.error(f)}}),d=h=>{h.preventDefault(),a.setFieldTouched("image",!0,!0),a.handleSubmit()};return l.jsxs("form",{className:o.form,onSubmit:d,children:[l.jsx(z,{onChange:s,photoUrl:u,error:a.errors.image,touched:a.touched.image}),l.jsx(P,{value:a.values.title,onChange:h=>{a.setFieldValue("title",h),r(h)},error:a.errors.title,touched:a.touched.title}),l.jsx(H,{value:a.values.text,onChange:h=>{a.setFieldValue("text",h),c(h)},error:a.errors.text,touched:a.touched.text}),l.jsx("button",{disabled:a.isSubmitting||t,type:"submit",className:o.button,children:a.isSubmitting||t?l.jsx("span",{className:"loading"}):"Publish Article"})]})},X="_title_10ppv_1",Y="_section_10ppv_6",se=()=>l.jsxs("section",{className:`container ${Y}`,children:[l.jsx("h1",{className:X,children:"Create an article"}),l.jsx(Q,{})]});export{se as default};
