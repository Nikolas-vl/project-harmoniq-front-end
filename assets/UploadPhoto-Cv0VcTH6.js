import{r as l,f as k,v as M,e as E,w as O,u as T,a as D,j as e,V as w}from"./index-BfNYoVeA.js";import{c as R,b as P,F as $,d as A,E as u,e as N}from"./index.esm-QPcuivvh.js";import{c as G}from"./photo-JblrDacA.js";import{u as V,e as q}from"./editor-SWL0cc2a.js";import{e as C,a as U}from"./eye-crossed-Dmo-NlkL.js";import{u as z,a as H}from"./useLoader-D9iqFZXZ.js";const J="_form_geit4_3",K="_wrapper_geit4_12",Q="_closeBtn_geit4_15",X="_mainText_geit4_24",Y="_fileInputWrapper_geit4_29",Z="_preview_geit4_60",ee="_previewWrapper_geit4_67",se="_editIcon_geit4_74",ae="_error_geit4_85",te="_saveBtn_geit4_94",re="_labelChangeInfo_geit4_113",oe="_inputChangeInfo_geit4_120",ne="_inputWrapper_geit4_129",ie="_seePass_geit4_136",s={form:J,wrapper:K,closeBtn:Q,mainText:X,fileInputWrapper:Y,preview:Z,previewWrapper:ee,editIcon:se,error:ae,saveBtn:te,labelChangeInfo:re,inputChangeInfo:oe,inputWrapper:ne,seePass:ie},le="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.25%201.25L8%208M8%208L1.25%2014.75M8%208L14.75%2014.75M8%208L14.75%201.25'%20stroke='%23070721'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ce=()=>{const[d,j]=l.useState(null),[c,o]=l.useState(!1),g=k();return z(c),{updateProfile:async(n,m)=>{o(!0);try{const r=await H(n,m);return j(r.data),g(M(r.user)),o(!1),r.data}catch(r){o(!1),console.error("Failed to update profile",r)}},isLoading:c,data:d}},pe=()=>{const d=E(),c=O().state?.isNew===!0,o=T(D),{updateProfile:g,loading:f}=ce(),{user:n}=V(o),[m,r]=l.useState(null),[h,v]=l.useState(null),[x,b]=l.useState(!1),[_,y]=l.useState(!1);l.useEffect(()=>{n?.avatarUrl&&r(n.avatarUrl)},[n]);const W=R({name:P().min(2,"At least 2 characters").max(32).trim(),oldPassword:P().min(6,"At least 6 characters"),newPassword:P().min(6,"At least 6 characters").when("oldPassword",{is:a=>a&&a.length>0,then:a=>a.required("New password required")})}),S=(a,i)=>{const t=a.target.files[0];if(t){if(t.size>2*1024*1024){i("image","The file is too large. Max 2MB.");return}if(!["image/jpeg","image/png"].includes(t.type)){i("image","Only JPG and PNG images allowed.");return}v(t),r(URL.createObjectURL(t)),i("image","")}},B=()=>{v(null),r(n?.avatarUrl||null),d(-1)};return e.jsx("div",{className:s.wrapper,children:e.jsx($,{enableReinitialize:!0,initialValues:{name:n?.name||"",oldPassword:"",newPassword:""},validationSchema:W,onSubmit:async(a,{setSubmitting:i})=>{const t=a.name.trim()!==n?.name,I=a.oldPassword.trim().length>0&&a.newPassword.trim().length>0,L=t||I||h;if(c&&!h){w.error("Please select a photo");return}if(!L){w.error("No changes made.");return}const p={};h&&(p.image=h),t&&(p.newName=a.name.trim()),I&&(p.oldPassword=a.oldPassword,p.newPassword=a.newPassword);try{await g(o,p),w.success("Profile updated"),d(`/authors/${o}`)}catch(F){w.error("Upload failed"),console.error(F)}finally{i(!1)}},children:({setFieldError:a,isSubmitting:i})=>e.jsxs(A,{className:s.form,children:[e.jsx("button",{type:"button",className:s.closeBtn,onClick:B,children:e.jsx("img",{src:le,alt:"close",className:s.icon})}),e.jsx("h2",{className:s.mainText,children:c?"Upload your photo":"Update your profile"}),e.jsxs("label",{htmlFor:"photo",className:s.fileInputWrapper,children:[m?e.jsxs("div",{className:s.previewWrapper,children:[e.jsx("img",{src:m,alt:"Preview",className:s.preview}),o&&e.jsx("img",{src:q,alt:"Change photo",className:s.editIcon})]}):e.jsx("img",{src:G,alt:"camera",className:s.icon}),e.jsx("input",{id:"photo",name:"image",type:"file",accept:"image/*",onChange:t=>S(t,a),className:s.fileInput})]}),e.jsx(u,{name:"image",component:"div",className:s.error}),!c&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:s.labelChangeInfo,children:["New name:",e.jsx(N,{type:"text",name:"name",className:s.inputChangeInfo}),e.jsx(u,{name:"name",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["Old password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:x?"text":"password",name:"oldPassword",placeholder:"Enter old password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>b(t=>!t),className:s.seePass,children:e.jsx("img",{src:x?C:U,alt:x?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(u,{name:"oldPassword",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["New password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(N,{type:_?"text":"password",name:"newPassword",placeholder:"Enter new password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>y(t=>!t),className:s.seePass,children:e.jsx("img",{src:_?C:U,alt:_?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(u,{name:"newPassword",component:"div",className:s.error})]})]}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:i||f,children:f?"Uploading...":"Save"})]})})})},de="_uploadPhotoWrapper_2t4vj_1",me={uploadPhotoWrapper:de},_e=()=>e.jsx("section",{className:`container ${me.uploadPhotoWrapper}`,children:e.jsx(pe,{})});export{_e as default};
