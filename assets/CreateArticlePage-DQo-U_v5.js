import{j as c,r as m,u as b,a as L,f as C,q as F,e as j,V as v}from"./index-Br6ym3h2.js";import{u as T,c as S,a as w,b as x}from"./index.esm-CKeQWjjR.js";import{c as q}from"./articlesApi-DtnMkk4E.js";const I="_form_iqafx_1",N="_titleLabel_iqafx_19",y="_fileLabel_iqafx_29",U="_textareaLabel_iqafx_38",A="_camera_iqafx_47",R="_fileInput_iqafx_66",$="_input_iqafx_69",E="_textarea_iqafx_38",O="_errored_iqafx_99",V="_error_iqafx_99",D="_button_iqafx_108",M="_success_iqafx_139",o={form:I,titleLabel:N,fileLabel:y,textareaLabel:U,camera:A,fileInput:R,input:$,textarea:E,errored:O,error:V,button:D,success:M},k=({error:t,onChange:s,photoUrl:n,touched:e})=>{const l=i=>{const a=i.target.files[0];if(a){if(a.size>2097152){alert("The file is too large. Maximum 2MB.");return}s&&s(a)}};return c.jsxs("label",{className:o.fileLabel,htmlFor:"upload-photo",children:[c.jsx("img",{width:361,height:233,id:"photo-preview",src:n,alt:"Click to upload",className:`${o.camera} ${e&&t?o.errored:""}`}),c.jsx("input",{name:"image",type:"file",id:"upload-photo",accept:"image/*",className:o.fileInput,onChange:l}),c.jsx("span",{className:e?t?o.error:o.success:"",children:e?t||"Image is valid":" "})]})},B=({touched:t,error:s,value:n,onChange:e})=>{const l=m.useRef(null);return m.useEffect(()=>{const i=l.current;if(!i)return;const a=i.clientHeight,u=()=>{i.style.height="auto";const g=Math.max(i.scrollHeight,a);i.style.height=`${g}px`};return i.addEventListener("input",u),()=>{i.removeEventListener("input",u)}},[]),c.jsxs("label",{className:o.textareaLabel,children:[c.jsx("textarea",{name:"text",ref:l,id:"article-text",placeholder:"Enter a text",className:`${o.textarea} ${t&&s?o.errored:""}`,value:n,onChange:i=>e(i.target.value),style:{resize:"none",overflow:"hidden"}}),c.jsx("span",{className:t?s?o.error:o.success:"",children:t?s||"Text is valid":" "})]})},z=({touched:t,error:s,value:n,onChange:e})=>{const l=m.useRef(null),i=()=>{const u=l.current;requestAnimationFrame(()=>{u.selectionStart=u.selectionEnd=u.value.length,u.scrollLeft=u.scrollWidth})},a=()=>{const u=l.current;u.scrollLeft=0};return c.jsxs("label",{className:o.titleLabel,htmlFor:"titleInput",children:["Article Title",c.jsx("input",{name:"title",ref:l,type:"text",id:"titleInput",className:`${o.input} ${t&&s?o.errored:""}`,placeholder:"Enter the title",onFocus:i,onBlur:a,value:n,onChange:u=>e(u.target.value)}),c.jsx("span",{className:t?s?o.error:o.success:"",children:t?s||"Title is valid":" "})]})},H=t=>{const n=t.match(/[^.!?]+[.!?]/);if(n){const e=n[0].trim();if(e.length>=10)return e.slice(0,100).trim()}return t.length>100?t.slice(0,97).trim()+"...":t.trim()},P=(t,s)=>{const n=m.useRef(null);m.useEffect(()=>(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{t()},s),()=>clearTimeout(n.current)),[t,s])};function J(t,s,n=1500){const[e,l]=m.useState(()=>{try{const a=localStorage.getItem(t);return a!==null?JSON.parse(a):s}catch{return s}}),i=m.useCallback(()=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(a){console.log(a)}},[t,e]);return P(i,n),[e,l]}const f="data:image/svg+xml,%3csvg%20width='391'%20height='280'%20viewBox='0%200%20391%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='391'%20height='280'%20fill='%239F9F9F'/%3e%3cpath%20d='M214.371%20146.212C214.371%20154.788%20206.099%20161.74%20195.897%20161.74C185.694%20161.74%20177.423%20154.788%20177.423%20146.212C177.423%20137.635%20185.694%20130.683%20195.897%20130.683C206.099%20130.683%20214.371%20137.635%20214.371%20146.212Z'%20stroke='%23070707'/%3e%3cpath%20d='M147.864%20167.625L147.864%20129.776C147.864%20123.416%20153.998%20118.26%20161.565%20118.26C166.755%20118.26%20171.499%20115.795%20173.82%20111.893L176.925%20106.673C179.494%20102.354%20184.747%2099.625%20190.492%2099.625L201.301%2099.625C207.047%2099.6251%20212.299%20102.354%20214.868%20106.673L217.973%20111.893C220.294%20115.795%20225.038%20118.26%20230.228%20118.26C237.795%20118.26%20243.929%20123.416%20243.929%20129.776V167.625C243.929%20174.667%20237.138%20180.375%20228.761%20180.375H163.032C154.655%20180.375%20147.864%20174.667%20147.864%20167.625Z'%20stroke='%23070707'/%3e%3c/svg%3e",W=t=>{const s=b(L),[n,e]=J("articleDraft",{title:"",text:"",image:null}),[l,i]=m.useState(f);m.useEffect(()=>()=>{l&&URL.revokeObjectURL(l)},[l]);const a=T({initialValues:n,validationSchema:S({title:x().required("Title is required").min(5,"Title must be at least 5 characters").max(100,"Title must be at most 100 characters"),text:x().required("Text is required").min(100,"Text must be at least 100 characters"),image:w().required("Image is required").test("fileSize","Maximum file size is 2MB",r=>!r||r&&r.size<=2*1024*1024).test("fileType","Only jpg and png images are allowed",r=>!r||r&&["image/jpeg","image/png"].includes(r.type))}),validateOnBlur:!1,validateOnChange:!0,onSubmit:async(r,{setSubmitting:h,setErrors:p})=>{try{const _={image:r.image,title:r.title,desc:H(r.text),article:r.text,rate:0,ownerId:s,date:new Date().toISOString()};await t(_),e({title:"",text:"",image:null}),i(f)}catch{p({submit:"Помилка при створенні статті. Спробуйте пізніше."})}finally{h(!1)}}});return{formik:a,previewUrl:l,handleFileChange:r=>{if(a.setFieldTouched("image",!0,!1),!r){i(f),a.setFieldValue("image",null),a.validateField("image");return}l&&URL.revokeObjectURL(l);const h=URL.createObjectURL(r);i(h),a.setFieldValue("image",r),a.validateField("image")},handleTitleChange:r=>{a.setFieldTouched("title",!0,!1),a.setFieldValue("title",r),e(h=>({...h,title:r}))},handleTextChange:r=>{a.setFieldTouched("text",!0,!1),a.setFieldValue("text",r),e(h=>({...h,text:r}))}}},Z=()=>{const[t,s]=m.useState(!1),n=C();return{create:async l=>{s(!0);try{const a=(await q(l)).data.data;return n(F(a)),a}catch(i){console.error("Failed to create article:",i)}finally{s(!1)}},isLoading:t}},G=()=>{const{create:t,isLoading:s}=Z(),n=j(),{formik:e,previewUrl:l,handleFileChange:i,handleTitleChange:a,handleTextChange:u}=W(async d=>{try{const h=(await t(d))._id;n(`/articles/${h}`)}catch(r){v.error("An error occurred when creating an article!"),console.error(r)}}),g=d=>{d.preventDefault(),e.setFieldTouched("image",!0,!0),e.handleSubmit()};return c.jsxs("form",{className:o.form,onSubmit:g,children:[c.jsx(k,{onChange:i,photoUrl:l,error:e.errors.image,touched:e.touched.image}),c.jsx(z,{value:e.values.title,onChange:d=>{e.setFieldValue("title",d),a(d)},error:e.errors.title,touched:e.touched.title}),c.jsx(B,{value:e.values.text,onChange:d=>{e.setFieldValue("text",d),u(d)},error:e.errors.text,touched:e.touched.text}),c.jsx("button",{disabled:e.isSubmitting||s,type:"submit",className:o.button,children:e.isSubmitting||s?c.jsx("span",{className:"loading"}):"Publish Article"})]})},K="_title_10ppv_1",Q="_section_10ppv_6",te=()=>c.jsxs("section",{className:`container ${Q}`,children:[c.jsx("h1",{className:K,children:"Create an article"}),c.jsx(G,{})]});export{te as default};
