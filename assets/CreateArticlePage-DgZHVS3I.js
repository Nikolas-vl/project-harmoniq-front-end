import{j as l,r as m}from"./index-CMIXuOn3.js";import{u as w,c as C,a as L,b as p}from"./index.esm-Be-eT___.js";const j="_form_asowa_1",F="_titleLabel_asowa_20",T="_fileLabel_asowa_30",v="_textareaLabel_asowa_39",S="_camera_asowa_48",y="_fileInput_asowa_64",N="_input_asowa_67",U="_textarea_asowa_39",I="_errored_asowa_94",$="_error_asowa_94",E="_button_asowa_101",o={form:j,titleLabel:F,fileLabel:T,textareaLabel:v,camera:S,fileInput:y,input:N,textarea:U,errored:I,error:$,button:E},R=({error:e,onChange:t,photoUrl:r})=>{const s=i=>{const a=i.target.files[0];if(a){if(a.size>2097152){alert("The file is too large. Maximum 2MB.");return}t&&t(a)}};return l.jsxs("label",{className:o.fileLabel,htmlFor:"upload-photo",children:[l.jsx("img",{width:361,height:233,id:"photo-preview",src:r,alt:"Click to upload",className:`${o.camera} ${e?o.errored:""}`}),l.jsx("input",{name:"image",type:"file",id:"upload-photo",accept:"image/*",className:o.fileInput,onChange:s}),e&&l.jsx("span",{className:o.error,children:e})]})},O=({touched:e,error:t,value:r,onChange:s})=>{const i=m.useRef(null);return m.useEffect(()=>{const a=i.current;if(!a)return;const u=a.clientHeight,c=()=>{a.style.height="auto";const h=Math.max(a.scrollHeight,u);a.style.height=`${h}px`};return a.addEventListener("input",c),()=>{a.removeEventListener("input",c)}},[]),l.jsxs("label",{className:o.textareaLabel,children:[l.jsx("textarea",{name:"text",ref:i,id:"article-text",placeholder:"Enter a text",className:`${o.textarea} ${e&&t?o.errored:""}`,value:r,onChange:a=>s(a.target.value),style:{resize:"none",overflow:"hidden"}}),e&&t&&l.jsx("span",{className:o.error,children:t})]})},A=({touched:e,error:t,value:r,onChange:s})=>{const i=m.useRef(null),a=()=>{const c=i.current;requestAnimationFrame(()=>{c.selectionStart=c.selectionEnd=c.value.length,c.scrollLeft=c.scrollWidth})},u=()=>{const c=i.current;c.scrollLeft=0};return l.jsxs("label",{className:o.titleLabel,htmlFor:"titleInput",children:["Article Title",l.jsx("input",{name:"title",ref:i,type:"text",id:"titleInput",className:`${o.input} ${e&&t?o.errored:""}`,placeholder:"Enter the title",onFocus:a,onBlur:u,value:r,onChange:c=>s(c.target.value)}),e&&t&&l.jsx("span",{className:o.error,children:t})]})},M=async e=>{const t=new FormData;return t.append("file",e),t.append("upload_preset","article_images"),(await(await fetch("https://api.cloudinary.com/v1_1/dlgcrdtgc/image/upload",{method:"POST",body:t})).json()).secure_url},q=async e=>{if(!e.current)return null;const t=await M(e.current);return e.current=null,t},D=e=>{const t=e.match(/[^.!?]+[.!?]/);if(t){const r=t[0].trim();if(r.length>=10)return r}return e.length>50?e.slice(0,50).trim()+"...":e.trim()},k=(e,t)=>{const r=m.useRef(null);m.useEffect(()=>(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e()},t),()=>clearTimeout(r.current)),[e,t])};function P(e,t,r=1500){const[s,i]=m.useState(()=>{try{const u=localStorage.getItem(e);return u!==null?JSON.parse(u):t}catch{return t}}),a=m.useCallback(()=>{try{localStorage.setItem(e,JSON.stringify(s))}catch(u){console.log(u)}},[e,s]);return k(a,r),[s,i]}const z="data:image/svg+xml,%3csvg%20width='391'%20height='280'%20viewBox='0%200%20391%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='391'%20height='280'%20fill='%239F9F9F'/%3e%3cpath%20d='M214.371%20146.212C214.371%20154.788%20206.099%20161.74%20195.897%20161.74C185.694%20161.74%20177.423%20154.788%20177.423%20146.212C177.423%20137.635%20185.694%20130.683%20195.897%20130.683C206.099%20130.683%20214.371%20137.635%20214.371%20146.212Z'%20stroke='%23070707'/%3e%3cpath%20d='M147.864%20167.625L147.864%20129.776C147.864%20123.416%20153.998%20118.26%20161.565%20118.26C166.755%20118.26%20171.499%20115.795%20173.82%20111.893L176.925%20106.673C179.494%20102.354%20184.747%2099.625%20190.492%2099.625L201.301%2099.625C207.047%2099.6251%20212.299%20102.354%20214.868%20106.673L217.973%20111.893C220.294%20115.795%20225.038%20118.26%20230.228%20118.26C237.795%20118.26%20243.929%20123.416%20243.929%20129.776V167.625C243.929%20174.667%20237.138%20180.375%20228.761%20180.375H163.032C154.655%20180.375%20147.864%20174.667%20147.864%20167.625Z'%20stroke='%23070707'/%3e%3c/svg%3e",B=e=>{const[t,r]=P("articleDraft",{title:"",text:"",image:null}),[s,i]=m.useState(z);m.useEffect(()=>()=>{s&&URL.revokeObjectURL(s)},[s]);const a=w({initialValues:t,validationSchema:C({title:p().required("Title is required").min(5,"Title must be at least 5 characters").max(100,"Title must be at most 100 characters"),text:p().required("Text is required").min(100,"Text must be at least 100 characters"),image:L().required("Image is required").test("fileSize","Maximum file size is 2MB",n=>!n||n&&n.size<=2*1024*1024).test("fileType","Only jpg and png images are allowed",n=>!n||n&&["image/jpeg","image/png"].includes(n.type))}),onSubmit:async(n,{setSubmitting:d,setErrors:f})=>{const x="User id from store",g=await q(n.image);if(!g){f({image:"Failed to upload image. Please try again."}),d(!1);return}const _=D(n.text),b={img:g,title:n.title,desc:_,article:n.text,rate:0,ownerId:x,date:new Date().toISOString()};await e(b),r({title:"",text:"",image:null}),i(null),d(!1)}});return{formik:a,previewUrl:s,handleFileChange:n=>{if(!n){i(null),a.setFieldValue("image",null);return}s&&URL.revokeObjectURL(s);const d=URL.createObjectURL(n);i(d),a.setFieldValue("image",n)},handleTitleChange:n=>{r(d=>({...d,title:n}))},handleTextChange:n=>{r(d=>({...d,text:n}))}}},H=()=>{const{formik:e,previewUrl:t,handleFileChange:r,handleTitleChange:s,handleTextChange:i}=B(async a=>{console.log("Відправляємо на бекенд:",a)});return l.jsxs("form",{className:o.form,onSubmit:e.handleSubmit,children:[l.jsx(R,{onChange:r,photoUrl:t,error:e.errors.image}),l.jsx(A,{value:e.values.title,onChange:a=>{e.setFieldValue("title",a),s(a)},error:e.errors.title,touched:e.touched.title}),l.jsx(O,{value:e.values.text,onChange:a=>{e.setFieldValue("text",a),i(a)},error:e.errors.text,touched:e.touched.text}),l.jsx("button",{disabled:e.isSubmitting,type:"submit",className:o.button,children:"Publish Article"})]})},V="_title_10ppv_1",J="_section_10ppv_6",G=()=>l.jsxs("section",{className:`container ${J}`,children:[l.jsx("h1",{className:V,children:"Create an article"}),l.jsx(H,{})]});export{G as default};
