import{r as l,c as F,f as k,n as M,u as E,s as O,j as e,V as h,e as T}from"./index-JqV-lfkm.js";import{c as R,b as N,F as $,d as A,E as w,e as j}from"./index.esm-cBK3dZfW.js";import{c as D}from"./photo-JblrDacA.js";import{u as G,e as V}from"./editor-EK94G52U.js";import{e as U,a as b}from"./eye-crossed-Dmo-NlkL.js";import{u as H,a as J}from"./useLoader-B9WKt1t7.js";const K="_form_18zq8_3",Q="_wrapper_18zq8_12",X="_closeBtn_18zq8_15",Y="_mainText_18zq8_24",Z="_fileInputWrapper_18zq8_29",ee="_preview_18zq8_59",se="_previewWrapper_18zq8_66",ae="_editIcon_18zq8_73",re="_error_18zq8_84",te="_saveBtn_18zq8_93",oe="_labelChangeInfo_18zq8_112",ne="_inputChangeInfo_18zq8_119",le="_inputWrapper_18zq8_128",ie="_seePass_18zq8_135",s={form:K,wrapper:Q,closeBtn:X,mainText:Y,fileInputWrapper:Z,preview:ee,previewWrapper:se,editIcon:ae,error:re,saveBtn:te,labelChangeInfo:oe,inputChangeInfo:ne,inputWrapper:le,seePass:ie},ce="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.25%201.25L8%208M8%208L1.25%2014.75M8%208L14.75%2014.75M8%208L14.75%201.25'%20stroke='%23070721'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",pe=()=>{const[u,p]=l.useState(null),[f,o]=l.useState(!1);return H(f),{updateProfile:async(g,d)=>{o(!0);try{const t=await J(g,d);return p(t.data),o(!1),t.data}catch(t){o(!1),console.error("Failed to update profile",t)}},isLoading:f,data:u}},de=()=>{const u=F(),p=k(),o=M().state?.isNew===!0,i=E(O),{updateProfile:g,loading:d}=pe(),{user:t}=G(i),[v,x]=l.useState(null),[m,I]=l.useState(null),[_,y]=l.useState(!1),[P,W]=l.useState(!1);l.useEffect(()=>{t?.avatarUrl&&x(t.avatarUrl)},[t]);const q=R({name:N().min(2,"At least 2 characters").max(32).trim(),oldPassword:N().min(6,"At least 6 characters"),newPassword:N().min(6,"At least 6 characters").when("oldPassword",{is:a=>a&&a.length>0,then:a=>a.required("New password required")})}),z=(a,n)=>{const r=a.target.files[0];if(r){if(r.size>2*1024*1024){n("image","The file is too large. Max 2MB.");return}if(!["image/jpeg","image/png"].includes(r.type)){n("image","Only JPG and PNG images allowed.");return}I(r),x(URL.createObjectURL(r)),n("image","")}},S=()=>{I(null),x(t?.avatarUrl||null),p(-1)};return e.jsx("div",{className:s.wrapper,children:e.jsx($,{enableReinitialize:!0,initialValues:{name:t?.name||"",oldPassword:"",newPassword:""},validationSchema:q,onSubmit:async(a,{setSubmitting:n})=>{const r=a.name.trim()!==t?.name,C=a.oldPassword.trim().length>0&&a.newPassword.trim().length>0,B=r||C||m;if(o&&!m){h.error("Please select a photo");return}if(!B){h.error("No changes made.");return}const c={};m&&(c.image=m),r&&(c.newName=a.name.trim()),C&&(c.oldPassword=a.oldPassword,c.newPassword=a.newPassword);try{await g(i,c),u(T()),h.success("Profile updated"),p(`/authors/${i}`)}catch(L){h.error("Upload failed"),console.error(L)}finally{n(!1)}},children:({setFieldError:a,isSubmitting:n})=>e.jsxs(A,{className:s.form,children:[e.jsx("button",{type:"button",className:s.closeBtn,onClick:S,children:e.jsx("img",{src:ce,alt:"close",className:s.icon})}),e.jsx("h2",{className:s.mainText,children:o?"Upload your photo":"Update your profile"}),e.jsxs("label",{htmlFor:"photo",className:s.fileInputWrapper,children:[v?e.jsxs("div",{className:s.previewWrapper,children:[e.jsx("img",{src:v,alt:"Preview",className:s.preview}),i&&e.jsx("img",{src:V,alt:"Change photo",className:s.editIcon})]}):e.jsx("img",{src:D,alt:"camera",className:s.icon}),e.jsx("input",{id:"photo",name:"image",type:"file",accept:"image/*",onChange:r=>z(r,a),className:s.fileInput})]}),e.jsx(w,{name:"image",component:"div",className:s.error}),!o&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:s.labelChangeInfo,children:["New name:",e.jsx(j,{type:"text",name:"name",className:s.inputChangeInfo}),e.jsx(w,{name:"name",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["Old password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(j,{type:_?"text":"password",name:"oldPassword",placeholder:"Enter old password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>y(r=>!r),className:s.seePass,children:e.jsx("img",{src:_?U:b,alt:_?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"oldPassword",component:"div",className:s.error})]}),e.jsxs("label",{className:s.labelChangeInfo,children:["New password:",e.jsxs("div",{className:s.inputWrapper,children:[e.jsx(j,{type:P?"text":"password",name:"newPassword",placeholder:"Enter new password",className:s.inputChangeInfo}),e.jsx("span",{onClick:()=>W(r=>!r),className:s.seePass,children:e.jsx("img",{src:P?U:b,alt:P?"Show password":"Hide password",width:24,height:24})})]}),e.jsx(w,{name:"newPassword",component:"div",className:s.error})]})]}),e.jsx("button",{type:"submit",className:s.saveBtn,disabled:n||d,children:d?"Uploading...":"Save"})]})})})},me="_uploadPhotoWrapper_2t4vj_1",he={uploadPhotoWrapper:me},Pe=()=>e.jsx("section",{className:`container ${he.uploadPhotoWrapper}`,children:e.jsx(de,{})});export{Pe as default};
